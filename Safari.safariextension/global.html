<html>
    <head>
        <script>
            function onRequest(event) {
                var xhr = new XMLHttpRequest();
                xhr.open("GET", event.message, true);
                xhr.onreadystatechange = function() {
                    if (xhr.readyState == 4) {
                        event.target.page.dispatchMessage(event.name, xhr.responseText);
                    }
                }
                xhr.send();
            };
            safari.application.addEventListener("message", onRequest, false);
        </script>
    </head>
</html>